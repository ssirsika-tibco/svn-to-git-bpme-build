<?xml version="1.0" encoding="UTF-8" ?>
<project name="maven-antrun-" default="main"  >
<target name="main">
  <taskdef resource="net/sf/antcontrib/antlib.xml"/>
  <echo message=""/>
  <echo message="*******************************************************"/>
  <echo message="Listing all jar.md in the C:\Code\WBPM\ace\branches\sv2git-migration\Authentication\com.tibco.bpm.auth.openid.feature\features\com.tibco.bpm.auth.openid.feature directory"/>
  <property name="jfrog.user" value="svc_amxbpmjfr@cloud.com"/>
  <property name="jfrog.password" value="eyJ2ZXIiOiIyIiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYiLCJraWQiOiJrdU5ERlBuc2dSeE44a1J2UlNHU3Z1eEZza0RsWlBLRnA3ZGVBZkVvc1VJIn0.eyJzdWIiOiJqZmFjQDAxaGVndHA1YXMwam03MWdhdnR0OG4xYWNxL3VzZXJzL3N2Y19hbXhicG1qZnJAY2xvdWQuY29tIiwic2NwIjoiYXBwbGllZC1wZXJtaXNzaW9ucy91c2VyIiwiYXVkIjoiKkAqIiwiaXNzIjoiamZmZUAwMWhlZ3RwNWFzMGptNzFnYXZ0dDhuMWFjcSIsImlhdCI6MTcyNzQxODk2NSwianRpIjoiNTNhZGJiNGMtMTY4MS00ZDMxLWIwMjEtNjQwYWJiNmUzZWJlIn0.UW1EijyOBz8_ffqRIRgRb1kj057V-3AgSdlprjcW21rGzJDxDRewsNI1zDgk4G789pQLAbbYFIYG_44-EZQmq3YluVoMZknUG3nFIDXqLlpE7IAaQ32_W9B0KRfPCXKJl-WcqjUZwW_YD4BZk3WAQ_sh_VLehqdcq-_0wvgNH3NBSyAZgK1w8sORBLGsuYrYciU2qhoHw8DqcKKaFfz_MV2O0GoNyvSsRMHt3zcB5dlQ7U_wX4t1a-lw_HsWN3ZrANFLHzZgRNGCD2sPJL7DEOquObj6dyGcswRUkquyEqEe_zXLVpo2ESK91XTTR8DZPnS_9Vey23z8LVoCbEEwPQ"/>
  <for param="file">
    <path>
      <fileset includes="**/*.md" dir="C:\Code\WBPM\ace\branches\sv2git-migration\Authentication\com.tibco.bpm.auth.openid.feature\features\com.tibco.bpm.auth.openid.feature"/>
    </path>
    <sequential>
      <echo message=""/>
      <echo message="==================================================="/>
      <echo message="jar.md file @{file}"/>
      <dirname file="@{file}" property="dir.name.@{file}"/>
      <echo message="dir name: ${dir.name.@{file}}"/>
      <condition property="isTest.@{file}">
        <contains string="${dir.name.@{file}}" substring="test"/>
      </condition>
      <echo message="isTest: ${isTest.@{file}}"/>
      <if>
        <equals arg2="true" arg1="${isTest.@{file}}"/>
        <then>
          <echo message="Skipping download of test file: @{file}"/>
        </then>
        <else>
          <echo message="Reading content of file @{file}"/>
          <propertyregex input="@{file}" regexp="(.*)\.md" select="\1" property="dest.file.name.@{file}"/>
          <echo message="Destination jar file name: ${dest.file.name.@{file}}"/>
          <loadfile property="fileContent.@{file}" srcfile="@{file}">
            <filterchain>
              <headfilter lines="1"/>
              <striplinebreaks/>
            </filterchain>
          </loadfile>
          <echo message="jar.md file content: ${fileContent.@{file}}"/>
          <condition property="isUrl.@{file}">
            <contains string="${fileContent.@{file}}" substring="http"/>
          </condition>
          <echo message="isUrl: ${isUrl.@{file}}"/>
          <if>
            <equals arg2="true" arg1="${isUrl.@{file}}"/>
            <then>
              <echo message="Downloading file from url: ${fileContent.@{file}}"/>
              <condition property="file.exists.@{file}">
                <available file="${dest.file.name.@{file}}"/>
              </condition>
              <if>
                <equals arg2="true" arg1="${file.exists.@{file}}"/>
                <then>
                  <echo message="File already exists: ${dest.file.name.@{file}}, skipping download"/>
                </then>
                <else>
                  <echo message="Running curl to download jar file"/>
                  <echo message="curl -u ${jfrog.user}:token -o ${dest.file.name.@{file}} -L -O ${fileContent.@{file}}"/>
                  <exec failonerror="true" executable="curl">
                    <arg value="-o"/>
                    <arg value="${dest.file.name.@{file}}"/>
                    <arg value="-L"/>
                    <arg value="-O"/>
                    <arg value="${fileContent.@{file}}"/>
                  </exec>
                  <echo message="Downloaded file: ${dest.file.name.@{file}}"/>
                </else>
              </if>
            </then>
            <else>
              <echo message="File content does not contain url, skipping download"/>
            </else>
          </if>
        </else>
      </if>
    </sequential>
  </for>
</target>
</project>